#!/bin/sh
# reminder: from now on, what follows the character # is a comment
# the ecuwfc value has to be set to the converged value of ex1.ecutwfc
# the kpoint mesh has to be set to the converged value of ex2.kpoints
# as well as alat

 cat > pw.si.scf.in << EOF
 &CONTROL
    prefix='silicon',
    pseudo_dir="./"
 /
 &SYSTEM    
    ibrav =  2, 
    celldm(1) = 10.1, 
    nat =  2, 
    ntyp = 1,
    ecutwfc = 20, 
 /
 &ELECTRONS
 /
ATOMIC_SPECIES
   Si  28.086  Si.pz-vbc.UPF
ATOMIC_POSITIONS
   Si 0.00 0.00 0.00 
   Si 0.25 0.25 0.25 
K_POINTS automatic
   4 4 4 1 1 1
EOF

    # run the pw.x calculation
    pw.x -in pw.si.scf.in > pw.si.scf.out

cat > pw.si.bands.in << EOF
 &CONTROL
    prefix='silicon',
    calculation='bands'
    pseudo_dir="./"
 /
 &SYSTEM
    ibrav =  2,
    celldm(1) = 10.1, 
    nat =  2,
    ntyp = 1,
    ecutwfc = 20,
 /
 &ELECTRONS
 /
ATOMIC_SPECIES
   Si  28.086  Si.pz-vbc.UPF
ATOMIC_POSITIONS
   Si 0.00 0.00 0.00
   Si 0.25 0.25 0.25
K_POINTS 
    39
    0.5000000000    0.5000000000    0.5000000000    1.0
    0.4500000000    0.4500000000    0.4500000000    1.0
    0.4000000000    0.4000000000    0.4000000000    1.0
    0.3500000000    0.3500000000    0.3500000000    1.0
    0.3000000000    0.3000000000    0.3000000000    1.0
    0.2500000000    0.2500000000    0.2500000000    1.0
    0.2000000000    0.2000000000    0.2000000000    1.0
    0.1500000000    0.1500000000    0.1500000000    1.0
    0.1000000000    0.1000000000    0.1000000000    1.0
    0.0500000000    0.0500000000    0.0500000000    1.0
    0.0000000000    0.0000000000    0.0000000000    1.0
    0.0454545455    0.0454545455    0.0000000000    1.0
    0.0909090909    0.0909090909    0.0000000000    1.0
    0.1363636364    0.1363636364    0.0000000000    1.0
    0.1818181818    0.1818181818    0.0000000000    1.0
    0.2272727273    0.2272727273    0.0000000000    1.0
    0.2727272727    0.2727272727    0.0000000000    1.0
    0.3181818182    0.3181818182    0.0000000000    1.0
    0.3636363636    0.3636363636    0.0000000000    1.0
    0.4090909091    0.4090909091    0.0000000000    1.0
    0.4545454545    0.4545454545    0.0000000000    1.0
    0.5000000000    0.5000000000    0.0000000000    1.0
    0.5000000000    0.5416666667    0.0416666667    1.0
    0.5000000000    0.5833333333    0.0833333333    1.0
    0.5000000000    0.6250000000    0.1250000000    1.0
    0.5000000000    0.6666666667    0.1666666667    1.0
    0.5000000000    0.7083333333    0.2083333333    1.0
    0.5000000000    0.7500000000    0.2500000000    1.0
    0.4687500000    0.7500000000    0.2812500000    1.0
    0.4375000000    0.7500000000    0.3125000000    1.0
    0.4062500000    0.7500000000    0.3437500000    1.0
    0.3750000000    0.7500000000    0.3750000000    1.0
    0.3928571429    0.7142857143    0.3928571429    1.0
    0.4107142857    0.6785714286    0.4107142857    1.0
    0.4285714286    0.6428571429    0.4285714286    1.0
    0.4464285714    0.6071428571    0.4464285714    1.0
    0.4642857143    0.5714285714    0.4642857143    1.0
    0.4821428571    0.5357142857    0.4821428571    1.0
    0.5000000000    0.5000000000    0.5000000000    1.0
EOF

    # run the band calculation with pw.x
    pw.x -in pw.si.bands.in > pw.si.bands.out

cat > Si.bands.in << EOF 
&BANDS
  prefix='silicon'
  filband = 'Si.bands.dat'
  lsym = .true.
/
EOF
    # run the postprocessing band.x
    bands.x < Si.bands.in > Si.bands.out


# plot the result

gnuplot plot.gp
